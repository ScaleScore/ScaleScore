<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ScaleScore — Quiz</title>

<!-- PDF.js from CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>

<style>
  :root{
    --cyan:#00FFFF;
    --bg:#000;
    --panel:#111;
    --muted:#bbb;
  }
  body{
    background:var(--bg);
    color:#fff;
    font-family: Inter, Arial, Helvetica, sans-serif;
    margin:0;
    padding:24px;
    display:flex;
    justify-content:center;
  }
  .card{
    width:100%;
    max-width:820px;
    background:var(--panel);
    border-radius:12px;
    padding:26px;
    box-shadow:0 8px 30px rgba(0,0,0,.6);
    box-sizing:border-box;
  }
  h1{ color:var(--cyan); margin:0 0 12px 0; text-align:center;}
  p.lead{ color:var(--muted); margin-top:6px; margin-bottom:16px; text-align:center;}
  .row{ display:flex; gap:16px; flex-wrap:wrap; }
  .col{ flex:1 1 220px; min-width:220px; }
  label{ display:block; margin-top:12px; font-weight:600; color:#eee; }
  select, input[type="text"], input[type="file"]{
    width:100%;
    padding:10px 12px;
    margin-top:8px;
    border-radius:8px;
    border:1px solid #333;
    background:#0d0d0d;
    color:#fff;
    box-sizing:border-box;
  }
  .radio-row{ margin-top:8px; display:flex; gap:12px; flex-wrap:wrap;}
  .radio-row label{ font-weight:400; color:#ddd; margin:0; }
  button{
    margin-top:18px;
    width:100%;
    padding:12px;
    background:var(--cyan);
    color:#000;
    font-weight:700;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-size:16px;
  }
  small.note{ display:block; margin-top:10px; color:#aaa; }

  /* compact question styling */
  .question { margin-top:12px; }
  .questions-grid{ display:grid; grid-template-columns:1fr; gap:6px; }
  @media(min-width:880px){ .questions-grid{ grid-template-columns:repeat(2,1fr); } }

  footer{ margin-top:18px; color:#888; font-size:13px; text-align:center; }
</style>
</head>
<body>
  <div class="card" role="main">
    <h1>ScaleScore</h1>
    <p class="lead">Quick, contextual scoring of your idea. Upload a pitch deck (optional) to boost accuracy.</p>

    <label for="brand">Brand / Company name</label>
    <input id="brand" type="text" placeholder="e.g. BlueLeaf Labs (optional)">

    <label for="sector">Sector</label>
    <select id="sector" required>
      <option value="" disabled selected>Choose sector</option>
      <option value="tech">Technology</option>
      <option value="retail">Retail / E-commerce</option>
      <option value="services">Services</option>
      <option value="food">Food & Beverage</option>
      <option value="finance">Finance / FinTech</option>
      <option value="other">Other</option>
    </select>

    <label for="pdfInput">Upload pitch deck / docs (PDF) — optional</label>
    <input id="pdfInput" type="file" accept="application/pdf" multiple />

    <small class="note">
      Documents are processed locally in your browser and are <strong>not</strong> uploaded to any server. They are not stored in a professional archival way — use at your discretion.
    </small>

    <hr style="border:none; height:1px; background:#111; margin:16px 0 8px 0;">

    <form id="quizForm">
      <!-- questions: same style and order as earlier / contextual scoring uses these -->
      <div class="questions-grid">
        <div>
          <label>Who is your primary customer?</label>
          <div class="radio-row">
            <label><input name="customer" type="radio" value="b2c" required> B2C</label>
            <label><input name="customer" type="radio" value="b2b"> B2B</label>
            <label><input name="customer" type="radio" value="both"> Both</label>
          </div>
        </div>

        <div>
          <label>Main revenue model</label>
          <div class="radio-row">
            <label><input name="revenue" type="radio" value="product_sales" required> Product sales</label>
            <label><input name="revenue" type="radio" value="service_fees"> Service fees</label>
            <label><input name="revenue" type="radio" value="ad_revenue"> Advertising</label>
            <label><input name="revenue" type="radio" value="subscription"> Subscription</label>
            <label><input name="revenue" type="radio" value="licensing"> Licensing</label>
          </div>
        </div>

        <div>
          <label>Price positioning</label>
          <div class="radio-row">
            <label><input name="price" type="radio" value="low_cost" required> Low cost</label>
            <label><input name="price" type="radio" value="mid_range"> Mid-range</label>
            <label><input name="price" type="radio" value="luxury"> Luxury / Premium</label>
          </div>
        </div>

        <div>
          <label>Primary marketing channel</label>
          <div class="radio-row">
            <label><input name="marketing" type="radio" value="digital_ads" required> Digital Ads</label>
            <label><input name="marketing" type="radio" value="organic_social"> Organic Social</label>
            <label><input name="marketing" type="radio" value="referrals"> Word of mouth / Referrals</label>
            <label><input name="marketing" type="radio" value="retail"> Retail / Physical</label>
            <label><input name="marketing" type="radio" value="content"> Content / SEO</label>
          </div>
        </div>

        <div>
          <label>Customer acquisition cost (estimate)</label>
          <div class="radio-row">
            <label><input name="cac" type="radio" value="under_10" required> Under £10</label>
            <label><input name="cac" type="radio" value="10_50"> £10–£50</label>
            <label><input name="cac" type="radio" value="over_50"> Over £50</label>
            <label><input name="cac" type="radio" value="unknown"> Not calculated</label>
          </div>
        </div>

        <div>
          <label>Monthly marketing budget</label>
          <div class="radio-row">
            <label><input name="mkt_budget" type="radio" value="0_500" required> £0–£500</label>
            <label><input name="mkt_budget" type="radio" value="500_2000"> £500–£2,000</label>
            <label><input name="mkt_budget" type="radio" value="2000_plus"> £2,000+</label>
          </div>
        </div>

        <div>
          <label>Funding status</label>
          <div class="radio-row">
            <label><input name="funding" type="radio" value="none" required> None</label>
            <label><input name="funding" type="radio" value="friends"> Friends & Family</label>
            <label><input name="funding" type="radio" value="angel"> Angel</label>
            <label><input name="funding" type="radio" value="vc"> VC</label>
          </div>
        </div>

        <div>
          <label>Product stage</label>
          <div class="radio-row">
            <label><input name="stage" type="radio" value="launched" required> Launched</label>
            <label><input name="stage" type="radio" value="beta"> Beta / testing</label>
            <label><input name="stage" type="radio" value="concept"> Concept / idea</label>
          </div>
        </div>

        <div>
          <label>Target reach</label>
          <div class="radio-row">
            <label><input name="reach" type="radio" value="global" required> International / global</label>
            <label><input name="reach" type="radio" value="national"> National</label>
            <label><input name="reach" type="radio" value="local"> Local / regional</label>
          </div>
        </div>

        <div>
          <label>Competition level</label>
          <div class="radio-row">
            <label><input name="competition" type="radio" value="first_mover" required> First mover / unique</label>
            <label><input name="competition" type="radio" value="few"> Few competitors</label>
            <label><input name="competition" type="radio" value="many"> Many established players</label>
          </div>
        </div>

        <div>
          <label>Typical usage frequency</label>
          <div class="radio-row">
            <label><input name="frequency" type="radio" value="daily" required> Daily</label>
            <label><input name="frequency" type="radio" value="weekly"> Weekly</label>
            <label><input name="frequency" type="radio" value="monthly"> Monthly/Occasional</label>
          </div>
        </div>

        <div>
          <label>Customer lifetime value (rough)</label>
          <div class="radio-row">
            <label><input name="clv" type="radio" value="low" required> Under £100</label>
            <label><input name="clv" type="radio" value="mid"> £100–£500</label>
            <label><input name="clv" type="radio" value="high"> £500+</label>
          </div>
        </div>
      </div>

      <button id="submitBtn" type="submit">Get ScaleScore</button>
    </form>

    <footer>
      <small>By continuing you agree documents are processed locally in your browser for scoring only.</small>
    </footer>
  </div>

<script>
/* ---------- Buzzword dictionaries (positive & negative) by sector ----------
   Each sector maps to arrays of positive buzzwords (raise score) and negative
   buzzwords (lower score). The search is case-insensitive substring match.
-------------------------------------------------------------------------- */
const BUZZ = {
  tech: {
    pos: ['saas','scalab','cloud','machine learning','ml','ai','automation','api','platform','microservice','on-demand','network effect','growth hacking'],
    neg: ['one-off','manual process','labour intensive','compliance risk','low margin']
  },
  retail: {
    pos: ['omnichannel','ecommerce','fulfilment','retail tech','brand loyalty','repeat purchase','retention'],
    neg: ['low margin','seasonal','high returns','fragile supply']
  },
  services: {
    pos: ['recurring','contract','saas','retainer','white label','enterprise'],
    neg: ['labour intensive','one-off','manual']
  },
  food: {
    pos: ['scalable kitchen','catering partnership','supply chain','franchise','subscription box'],
    neg: ['perishable','high wastage','low margin','regulatory']
  },
  finance: {
    pos: ['regtech','api','compliance automation','payment rails','underwriting','risk modelling'],
    neg: ['heavy regulation','legacy integrations','counterparty risk']
  },
  other: {
    pos: ['scalable','partnership','recurring','platform'],
    neg: ['labour','one-off','low margin']
  }
};

/* PDF text extraction using PDF.js (client-side).
   Accept multiple files; returns combined text as lower-case string. */
async function extractTextFromPDFFile(file) {
  const arrayBuffer = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
  let fullText = '';
  for (let p = 1; p <= pdf.numPages; p++) {
    try {
      const page = await pdf.getPage(p);
      const content = await page.getTextContent();
      const strings = content.items.map(i => (i.str || '')).join(' ');
      fullText += ' ' + strings;
    } catch(e){
      console.warn('PDF page error', e);
    }
  }
  return fullText.toLowerCase();
}

/* Helper: count occurrences of each buzzword. Simple substring match.*/
function scanForBuzzwords(text, sector){
  const bucket = {positive: {}, negative:{}};
  const set = BUZZ[sector] || BUZZ.other;
  set.pos.forEach(word => {
    const re = new RegExp(word.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'),'gi');
    const count = (text.match(re) || []).length;
    if(count) bucket.positive[word] = count;
  });
  set.neg.forEach(word => {
    const re = new RegExp(word.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'),'gi');
    const count = (text.match(re) || []).length;
    if(count) bucket.negative[word] = count;
  });
  return bucket;
}

/* Contextual scoring logic (based on your earlier rules).
   This is intentionally similar to the working logic we used before but
   more deterministic and returns structured feedback. */
function computeScoreAndFeedback(answers, buzzSummary){
  let score = 50;

  // sector boost
  if(answers.sector === 'tech' || answers.sector === 'finance') score += 10;
  if(answers.sector === 'retail' || answers.sector === 'food') score += 5;

  // customer
  if(answers.customer === 'b2b') score += 8;
  else if(answers.customer === 'both') score += 5;
  else score += 4;

  // revenue model
  if(answers.revenue === 'subscription' || answers.revenue === 'service_fees') score += 10;
  else if(answers.revenue === 'ad_revenue') score += 5;
  else if(answers.revenue === 'product_sales') score += 7;
  else score += 6;

  // price
  if(answers.price === 'luxury') score += 7;
  else if(answers.price === 'mid_range') score += 5;
  else score += 3;

  // marketing
  if(answers.marketing === 'digital_ads' || answers.marketing === 'social_media') score += 10;
  else if(answers.marketing === 'content') score += 8;
  else score += 5;

  // CAC
  if(answers.cac === 'under_10') score += 7;
  else if(answers.cac === '10_50') score += 4;
  else if(answers.cac === 'over_50') score -= 4;
  else score += 0;

  // marketing budget
  if(answers.mkt_budget === '2000_plus') score += 8;
  else if(answers.mkt_budget === '500_2000') score += 4;
  else score += 0;

  // funding
  if(answers.funding === 'vc') score += 12;
  else if(answers.funding === 'angel') score += 8;
  else if(answers.funding === 'friends') score += 5;
  else { // none
    if(answers.sector === 'tech' || answers.sector === 'finance') score -= 5;
  }

  // stage
  if(answers.stage === 'launched') score += 10;
  else if(answers.stage === 'beta') score += 5;
  else score += 0;

  // reach
  if(answers.reach === 'global') score += 8;
  else if(answers.reach === 'national') score += 4;

  // competition
  if(answers.competition === 'first_mover') score += 8;
  else if(answers.competition === 'few') score += 4;
  else score -= 6;

  // frequency
  if(answers.frequency === 'daily') score += 8;
  else if(answers.frequency === 'weekly') score += 4;

  // clv
  if(answers.clv === 'high') score += 8;
  else if(answers.clv === 'mid') score += 4;

  // ---------------------------------
  // incorporate buzzword-based adjustments
  // positive words increase score slightly, negatives reduce it.
  let buzzAdjust = 0;
  const posWords = buzzSummary.positive || {};
  const negWords = buzzSummary.negative || {};
  Object.values(posWords).forEach(count => { buzzAdjust += Math.min(6, count * 1.5); }); // cap
  Object.values(negWords).forEach(count => { buzzAdjust -= Math.min(8, count * 1.5); });
  score += Math.round(buzzAdjust);

  // clamp
  score = Math.max(0, Math.min(100, Math.round(score)));

  // Build strengths & improvements from answers & buzz words
  const strengths = [];
  const improvements = [];
  // strengths heuristics
  if(answers.stage === 'launched') strengths.push('Product already launched — you can iterate with real users.');
  if(answers.mkt_budget === '2000_plus') strengths.push('You have marketing budget to scale fast.');
  if(answers.funding === 'vc' || answers.funding === 'angel') strengths.push('External funding gives runway to grow quickly.');
  if(Object.keys(posWords).length) strengths.push('Deck contains sector-relevant positive terms suggesting alignment with trends.');

  // improvements heuristics
  if(answers.funding === 'none') improvements.push('Consider options to raise initial funding or validate with low-cost pilots.');
  if(answers.cac === 'over_50') improvements.push('Customer acquisition cost looks high — optimise channels or improve LTV.');
  if(answers.competition === 'many') improvements.push('Strong competition — sharpen your USP and defensibility.');
  if(Object.keys(negWords).length) improvements.push('Deck contains potential red flags; address these issues in product or GTM strategy.');

  // recommendations: actionable tips
  const recommendations = [];
  if(answers.revenue === 'subscription') recommendations.push('Prioritise retention, onboarding funnels and churn reduction to secure recurring revenue.');
  if(answers.revenue === 'ad_revenue') recommendations.push('Scale user base and engagement; optimise placement and targeting.');
  if(answers.price === 'low_cost') recommendations.push('Focus on unit economics and operational efficiency for margin improvements.');
  if(answers.customer === 'b2b') recommendations.push('Build sales processes, partnerships and enterprise contracts to accelerate large deals.');
  if(answers.marketing === 'digital_ads') recommendations.push('A/B test creative & funnel; measure CAC vs LTV closely.');
  if(Object.keys(posWords).length) recommendations.push('Capitalize on the strengths found in your deck by highlighting them in investor materials.');
  if(Object.keys(negWords).length) recommendations.push('Address the flagged issues in the deck and include mitigation plans in your next iteration.');

  // final output
  return {
    score,
    buzzAdjust,
    strengths,
    improvements,
    recommendations,
    buzzSummary
  };
}

/* Take all form answers and return an object */
function collectAnswers() {
  const sector = document.getElementById('sector').value;
  const brand = document.getElementById('brand').value.trim();
  const getRadio = name => (document.querySelector(`input[name="${name}"]:checked`) || {}).value || null;
  return {
    brand,
    sector,
    customer: getRadio('customer'),
    revenue: getRadio('revenue'),
    price: getRadio('price'),
    marketing: getRadio('marketing'),
    cac: getRadio('cac'),
    mkt_budget: getRadio('mkt_budget'),
    funding: getRadio('funding'),
    stage: getRadio('stage'),
    reach: getRadio('reach'),
    competition: getRadio('competition'),
    frequency: getRadio('frequency'),
    clv: getRadio('clv')
  };
}

/* main submit handler */
document.getElementById('quizForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const submitBtn = document.getElementById('submitBtn');
  submitBtn.disabled = true;
  submitBtn.textContent = 'Analysing...';

  const answers = collectAnswers();

  // parse PDFs if provided
  const files = document.getElementById('pdfInput').files;
  let combinedText = '';
  if(files && files.length){
    for(let i=0;i<files.length;i++){
      try{
        const chunk = await extractTextFromPDFFile(files[i]);
        combinedText += ' ' + chunk;
      } catch(err){
        console.warn('Failed parse pdf', err);
      }
    }
  }

  // scan for buzzwords using chosen sector
  const text = combinedText || '';
  const buzzSummary = text ? scanForBuzzwords(text, answers.sector || 'other') : {positive:{}, negative:{}};

  // compute score + feedback
  const result = computeScoreAndFeedback(answers, buzzSummary);
  result.answers = answers;
  result.brand = answers.brand || '';
  result.timestamp = new Date().toISOString();

  // store in sessionStorage (so results page can read it)
  sessionStorage.setItem('scalescore_result', JSON.stringify(result));

  // redirect to results page
  window.location.href = 'results.html';
});
</script>
</body>
</html>
